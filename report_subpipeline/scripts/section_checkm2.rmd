## Checkm2

```{r checkm2, echo = F, message = F, warning = F, error = T}





# Read raw input
checkm2_raw = read_tsv(glob_list$checkm2)

checkm2_presentable = metadata_translate %>%
    select(sample) %>%
    left_join(checkm2_raw, by = c("sample" = "Name")) %>%
    
    mutate(
        #Completeness_Model_Used = str_replace(Completeness_Model_Used, "Neural Network", "NN"),
        Average_Gene_Length = round(Average_Gene_Length, 1)
    ) %>%
    rename_with(str_replace_all, pattern = "_", replacement = " ")
    

checkm2_presentable %>%
    custom_dt("checkm2")


```

*Table `r tableno()`: [Checkm2](https://github.com/chklovski/CheckM2) results. *



```{r checkm2_plot_new, echo=FALSE, message=F, warning=F, error = T, fig.height = max(1.8, N*0.2), fig.width = 10}

# New better plot. 
# checkm2_presentable  %>% 

#     select(sample, Completeness, Contamination, `Completeness Model Used`) %>%
#     pivot_longer(c(Completeness, Contamination))  %>% 

#     ggplot(aes(value, sample)) + 
#     geom_col() +
#     facet_wrap(~name)
    #scale_x_reverse()


left = checkm2_presentable  %>% 
    ggplot(aes(Contamination, reorder(sample, desc(sample)))) + 
    geom_col(fill = "#aa00a7") +
    scale_x_reverse() + 
    theme_bw() + 
    theme(
        panel.border = element_blank(),
        #panel.grid.major = element_blank(), 
        #panel.grid.minor = element_blank(),
        axis.line.x = element_line(colour = "black", linewidth = rel(1)),
    ) + 
    labs(
        y = "sample"
    )

right = checkm2_presentable  %>% 
    ggplot(aes(Completeness, reorder(sample, desc(sample)))) + 
    geom_col(fill = "#00ab0e") +
    theme_bw() +
    theme(
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),

        panel.border = element_blank(),
        #panel.grid.major = element_blank(), 
        #panel.grid.minor = element_blank(),
        axis.line.x = element_line(colour = "black", linewidth = rel(1))
    )


    


# Plot contamination and completeness side by side, scaled by max value of each (to get roughly the same ratio)
grid.arrange(left, right,
    ncol = 2,
    widths = c(
        max(checkm2_presentable$Contamination), 
        max(checkm2_presentable$Completeness)
        )
    )


```



*Fig. `r figno()`: [Checkm2](https://github.com/chklovski/CheckM2) results. Axes are in percents.*


---